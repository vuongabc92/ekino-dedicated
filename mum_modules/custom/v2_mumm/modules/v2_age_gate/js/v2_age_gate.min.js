(function (a) {
    Drupal.behaviors.mumm_age_gate = {attach: function (g, u) {
            var e = a("#birthdate-wrapper", g);
            if (!e.length) {
                return
            }
            var w = a("#edit-country", g);
            var p = a("input[name=year]", e), x = a("input[name=month]", e), m = a("input[name=day]", e), t = a("#info-field"), r = a("#error-field"), k = 0, n = a(".form-item-year", e), v = a(".form-item-month", e), q = a(".form-item-day", e), h = a("#error-mandatory-fields"), o = a("#error-underaged-format"), d = a("#error-underaged"), b = a("#error-no-legal-age");
            v.hide();
            q.hide();
            o.hide();
            function s() {
                var y, z;
                y = w.val();
                z = Drupal.settings.mumm_age_gate.country_date_formats[y] || "ddmmyyyy";
                switch (z) {
                    case"mmddyyyy":
                        q.insertAfter(v);
                        n.insertAfter(q);
                        break;
                    case"yyyymmdd":
                        v.insertAfter(n);
                        q.insertAfter(v);
                        break;
                    default:
                        v.insertAfter(q);
                        n.insertAfter(v);
                        break
                }
            }
            function f() {
                var z = w.val();
                var y = Drupal.settings.mumm_age_gate.country_full_birthday[z];
                if (y && y === true) {
                    v.stop(true, true).fadeIn();
                    q.stop(true, true).fadeIn();
                    return true
                }
                return false
            }
            function j() {
                var y = w.val(), A = Drupal.settings.mumm_age_gate.country_ages[y], z = new Date().getFullYear() - p.val();
                if (z == A) {
                    v.stop(true, true).fadeIn()
                } else {
                    v.stop(true, true).fadeOut();
                    q.stop(true, true).fadeOut()
                }
            }
            function l() {
                var z = new Date().getMonth() + 1, y;
                if (x.val()[0] == "0" && x.val().length == 1) {
                    return
                } else {
                    if (x.val()[0] == "0" && x.val().length == 2) {
                        y = x.val()[1]
                    } else {
                        y = x.val()
                    }
                }
                if (z == y) {
                    q.stop(true, true).fadeIn()
                } else {
                    q.stop(true, true).fadeOut()
                }
            }
            function i() {
                var A = w.val(), B = Drupal.settings.mumm_age_gate.country_ages[A], z = a("input[name=has_been_submitted]").val();
                h.hide();
                d.hide();
                b.hide();
                if (B == -1) {
                    b.show()
                } else {
                    if (z == 1 && k == 0) {
                        if (p.val()) {
                            b.show()
                        }
                    } else {
                        var y = o.text();
                        d.text(y.replace("@legal_age", B));
                        d.show()
                    }
                }
                if (p.val().length == 0 && z == 1) {
                    h.show()
                }
            }
            function c() {
                i();
                s();
                if (f() === true) {
                    return
                }
                j();
                l()
            }
            w.change(c);
            c();
            p.keyup(function () {
                if (p.val().length == 4) {
                    if (f() === true) {
                        return
                    }
                    j()
                }
            });
            x.keyup(function () {
                if (x.val().length >= 1) {
                    if (f() === true) {
                        return
                    }
                    l()
                }
            });
            (function (y) {
                if (!y.length) {
                    return
                }
                setTimeout(function () {
                    y.addClass("loaded")
                }, 100)
            })(a(".inner-age-gate", g));
            a(g).on("fb_initialized", function () {
                var C = a(".fb-connect", g), z = false, y = false;
                function B(D) {
                    z = false;
                    if (D.status === "connected") {
                        y = true;
                        A()
                    }
                }
                function A() {
                    FB.api("/me", function (E) {
                        if (E.hasOwnProperty("birthday")) {
                            var D = E.birthday.match(/(\d{2})\/(\d{2})\/(\d{4})/);
                            p.val(D[3]);
                            x.val(D[1]);
                            m.val(D[2])
                        }
                    })
                }
                FB.getLoginStatus(function (D) {
                    if (D.status === "connected") {
                        y = true;
                        C.addClass("disabled");
                        A();
                        return
                    }
                    C.click(function (E) {
                        E.preventDefault();
                        if (!y && !z) {
                            z = true;
                            FB.login(B, {scope: "user_location, user_birthday"})
                        }
                    })
                })
            })
        }}
})(jQuery);